// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



enum Role {
  CLIENT
  FREELANCER
  ADMIN
}

model User {
  id          String       @id @default(uuid())
  full_name   String       @db.VarChar(100)
  username    String       @unique @db.VarChar(50)
  email       String       @unique @db.VarChar(100)
  password    String       @db.VarChar(255)
  role        Role         @default(CLIENT)
  avatar_url  String?      @db.Text
  bio         String?      @db.Text
  country     String?      @db.VarChar(50)
  verified    Boolean      @default(false)
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt

  // Relations
  profile          Profile?
  gigs             Gig[]
  ordersBuyer      Order[]      @relation("BuyerOrders")
  ordersSeller     Order[]      @relation("SellerOrders")
  conversationsBuyer Conversation[] @relation("BuyerConversations")
  conversationsSeller Conversation[] @relation("SellerConversations")
  messages         Message[]
  reviewsGiven     Review[]    @relation("Reviewer")
  reviewsReceived  Review[]    @relation("Reviewee")
  wallet           Wallet?
  notifications    Notification[]
  adminLogs        AdminLog[]
  disputesRaised   Dispute[]

  @@map("users")
}

model Profile {
  id               String   @id @default(uuid())
  user_id          String   @unique
  title            String?  @db.VarChar(100)
  hourly_rate      Decimal? @db.Decimal(10, 2)
  skills           String?  @db.Text
  experience_years Int? 
  languages        String?  @db.Text
  portfolio_url    String?  @db.Text
  availability     String?  @db.VarChar(20) // available, busy, offline
  rating_avg       Decimal? @db.Decimal(3, 2)
  total_reviews    Int?     @default(0)

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("profiles")
}

model Category {
  id          String      @id @default(uuid())
  name        String      @db.VarChar(50)
  description String?     @db.Text
  parent_id   String? 
  icon        String?     @db.Text

  parent   Category? @relation("CategoryParent", fields: [parent_id], references: [id])
  children Category[] @relation("CategoryParent")
  gigs     Gig[]

  @@map("categories")
}

model Gig {
  id             String   @id @default(uuid())
  user_id        String
  title          String   @db.VarChar(120)
  description    String   @db.Text
  category_id    String
  price_basic    Decimal  @db.Decimal(10,2)
  price_standard Decimal  @db.Decimal(10,2)
  price_premium  Decimal  @db.Decimal(10,2)
  delivery_days  Int
  revisions      Int
  thumbnail      String?  @db.Text
  images         String?  @db.Text
  status         String   @default("active") @db.VarChar(20)
  created_at     DateTime @default(now())

  user      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  category  Category @relation(fields: [category_id], references: [id], onDelete: SetNull)
  orders    Order[]

  @@map("gigs")
}

model Order {
  id             String   @id @default(uuid())
  buyer_id       String
  seller_id      String
  gig_id         String
  status         String   @default("pending") @db.VarChar(20)
  amount         Decimal  @db.Decimal(10,2)
  delivery_date  DateTime?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  buyer    User  @relation("BuyerOrders", fields: [buyer_id], references: [id])
  seller   User  @relation("SellerOrders", fields: [seller_id], references: [id])
  gig      Gig   @relation(fields: [gig_id], references: [id])
  reviews  Review[]
  disputes Dispute[]

  @@map("orders")
}

model Conversation {
  id           String   @id @default(uuid())
  buyer_id     String
  seller_id    String
  last_message String?  @db.Text
  updated_at   DateTime @updatedAt

  buyer  User @relation("BuyerConversations", fields: [buyer_id], references: [id])
  seller User @relation("SellerConversations", fields: [seller_id], references: [id])
  messages Message[]

  @@map("conversations")
}

model Message {
  id               String   @id @default(uuid())
  conversation_id  String
  sender_id        String
  content          String   @db.Text
  attachments      String?  @db.Text
  is_read          Boolean  @default(false)
  sent_at          DateTime @default(now())

  conversation Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  sender       User         @relation(fields: [sender_id], references: [id])

  @@map("messages")
}

model Review {
  id           String   @id @default(uuid())
  order_id     String
  reviewer_id  String
  reviewee_id  String
  rating       Int
  comment      String?  @db.Text
  created_at   DateTime @default(now())

  order     Order @relation(fields: [order_id], references: [id])
  reviewer  User  @relation("Reviewer", fields: [reviewer_id], references: [id])
  reviewee  User  @relation("Reviewee", fields: [reviewee_id], references: [id])

  @@map("reviews")
}

model Wallet {
  id           String   @id @default(uuid())
  user_id      String   @unique
  balance      Decimal  @default(0.00) @db.Decimal(10,2)
  currency     String   @default("USD") @db.VarChar(10)
  last_updated DateTime @updatedAt

  user         User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("wallets")
}

model Transaction {
  id          String   @id @default(uuid())
  wallet_id   String
  type        String   @db.VarChar(20)
  amount      Decimal  @db.Decimal(10,2)
  reference   String?  @db.VarChar(100)
  created_at  DateTime @default(now())

  wallet Wallet @relation(fields: [wallet_id], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Notification {
  id         String   @id @default(uuid())
  user_id    String
  title      String   @db.VarChar(100)
  message    String   @db.Text
  type       String   @db.VarChar(20)
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model AdminLog {
  id          String   @id @default(uuid())
  admin_id    String
  action      String   @db.VarChar(100)
  target_id   String?
  target_type String?  @db.VarChar(20)
  created_at  DateTime @default(now())

  admin User @relation(fields: [admin_id], references: [id], onDelete: Cascade)

  @@map("admin_logs")
}

model Setting {
  id          String   @id @default(uuid())
  key         String   @unique @db.VarChar(100)
  value       String?  @db.Text
  updated_at  DateTime @updatedAt

  @@map("settings")
}

model Dispute {
  id           String   @id @default(uuid())
  order_id     String
  raised_by    String
  reason       String?  @db.Text
  evidence     String?  @db.Text
  status       String   @default("open") @db.VarChar(20)
  resolution   String?  @db.Text
  created_at   DateTime @default(now())
  resolved_at  DateTime?

  order   Order @relation(fields: [order_id], references: [id])
  raiser  User  @relation(fields: [raised_by], references: [id])

  @@map("disputes")
}