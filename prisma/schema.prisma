generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CLIENT
  FREELANCER
  ADMIN
  SUPER_ADMIN
}

// sdrtfygutrdfyguhyi
enum UserStatus {
  ACTIVE
  BLOCKED
  SUSPENDED
  PENDING
}

enum GigStatus {
  ACTIVE
  PAUSED
  DELETED
  DRAFT
}

enum OrderStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  DELIVERED
  COMPLETED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  INITIATED
  SUCCESS
  FAILED
  REFUNDED
}

enum PaymentMethod {
  STRIPE
  PAYPAL
  WALLET
  FAKE
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
  PLATFORM_FEE
  REFUND
}

enum NotificationType {
  ORDER
  PAYMENT
  SYSTEM
  CHAT
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  REJECTED
}

model user {
  id                 Int        @id @default(autoincrement()) @db.Integer
  full_name          String?    @db.VarChar(100)
  username           String?    @unique @db.VarChar(50)
  email              String?    @unique @db.VarChar(100)
  password           String     @db.VarChar(255)
  role               UserRole   @default(CLIENT)
  status             UserStatus @default(PENDING)
  isActive           Boolean    @default(false)
  avatar_url         String?    @db.Text
  bio                String?    @db.Text
  hashedRefreshToken String?
  country            String?    @db.VarChar(50)
  created_at         DateTime   @default(now())
  updated_at         DateTime   @updatedAt

  profile               profile?
  gigs                  gig[]
  buyerOrders           orders[]       @relation("buyer_orders")
  sellerOrders          orders[]       @relation("seller_orders")
  payments              payment[]
  messagesSent          message[]      @relation("messages_sender")
  conversationsAsBuyer  conversation[] @relation("convo_buyer")
  conversationsAsSeller conversation[] @relation("convo_seller")
  reviewsWritten        review[]       @relation("reviewer")
  reviewsReceived       review[]       @relation("reviewee")
  wallet                wallet?
  transactions          transactions[]
  notifications         notification[]
  adminLogs             admin_logs[]   @relation("admin_logs_user")
  disputes_raised       dispute[]

  @@map("users")
}

model profile {
  id               Int      @id @default(autoincrement()) @db.Integer
  user_id          Int      @unique
  title            String?  @db.VarChar(100)
  hourly_rate      Decimal? @db.Decimal(10, 2)
  skills           String[]
  experience_years Int?
  languages        String[]
  portfolio_url    String?  @db.Text
  availability     String?  @db.VarChar(20)
  rating_avg       Decimal? @default("0.00") @db.Decimal(3, 2)
  total_reviews    Int?     @default(0)

  user user @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("profiles")
}

model gig {
  id             Int       @id @default(autoincrement()) @db.Integer
  user_id        Int
  title          String    @db.VarChar(120)
  description    String?   @db.Text
  category_id    Int?
  price_basic    Decimal   @db.Decimal(10, 2)
  price_standard Decimal?  @db.Decimal(10, 2)
  price_premium  Decimal?  @db.Decimal(10, 2)
  delivery_days  Int?
  revisions      Int?      @default(0)
  thumbnail      String?   @db.Text
  images         String[]
  status         GigStatus @default(ACTIVE)
  isActive       Boolean   @default(false)
  created_at     DateTime  @default(now())

  user     user      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  category category? @relation(fields: [category_id], references: [id])

  orders  orders[]
  reviews review[] @relation("gig_reviews")

  @@map("gigs")
}

model category {
  id          Int     @id @default(autoincrement()) @db.Integer
  name        String  @db.VarChar(50)
  description String? @db.Text
  parent_id   Int?
  icon        String? @db.Text

  parent   category?  @relation("category_children", fields: [parent_id], references: [id])
  children category[] @relation("category_children")

  gigs gig[]

  @@map("categories")
}

model orders {
  id            Int         @id @default(autoincrement()) @db.Integer
  buyer_id      Int
  seller_id     Int
  gig_id        Int?
  status        OrderStatus @default(PENDING)
  amount        Decimal     @db.Decimal(10, 2)
  delivery_date DateTime?
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  buyer  user @relation("buyer_orders", fields: [buyer_id], references: [id], onDelete: Cascade)
  seller user @relation("seller_orders", fields: [seller_id], references: [id], onDelete: Cascade)
  gig    gig? @relation(fields: [gig_id], references: [id], onDelete: SetNull)

  payments payment[]
  disputes dispute[]
  reviews  review[]  @relation("order_reviews")

  @@map("orders")
}

model payment {
  id             Int           @id @default(autoincrement()) @db.Integer
  order_id       Int?
  buyer_id       Int?
  amount         Decimal       @db.Decimal(10, 2)
  status         PaymentStatus @default(INITIATED)
  method         PaymentMethod
  transaction_id String?       @db.VarChar(100)
  created_at     DateTime      @default(now())

  order orders? @relation(fields: [order_id], references: [id], onDelete: SetNull)
  buyer user?   @relation(fields: [buyer_id], references: [id], onDelete: SetNull)

  @@map("payments")
}

model message {
  id              Int      @id @default(autoincrement()) @db.Integer
  conversation_id Int
  sender_id       Int
  content         String?  @db.Text
  attachments     String[]
  is_read         Boolean  @default(false)
  sent_at         DateTime @default(now())

  conversation conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  sender       user         @relation("messages_sender", fields: [sender_id], references: [id], onDelete: Cascade)

  @@map("messages")
}

model conversation {
  id           Int      @id @default(autoincrement()) @db.Integer
  buyer_id     Int
  seller_id    Int
  last_message String?  @db.Text
  updated_at   DateTime @updatedAt

  buyer  user @relation("convo_buyer", fields: [buyer_id], references: [id], onDelete: Cascade)
  seller user @relation("convo_seller", fields: [seller_id], references: [id], onDelete: Cascade)

  messages message[]

  @@map("conversations")
}

model review {
  id          Int      @id @default(autoincrement()) @db.Integer
  order_id    Int?
  reviewer_id Int
  reviewee_id Int
  gig_id      Int?
  rating      Int
  comment     String?  @db.Text
  created_at  DateTime @default(now())

  order    orders? @relation("order_reviews", fields: [order_id], references: [id], onDelete: SetNull)
  reviewer user    @relation("reviewer", fields: [reviewer_id], references: [id], onDelete: Cascade)
  reviewee user    @relation("reviewee", fields: [reviewee_id], references: [id], onDelete: Cascade)
  gig      gig?    @relation("gig_reviews", fields: [gig_id], references: [id], onDelete: SetNull)

  @@map("reviews")
}

model wallet {
  id           Int      @id @default(autoincrement()) @db.Integer
  user_id      Int      @unique
  balance      Decimal  @default("0.00") @db.Decimal(14, 2)
  currency     String   @default("USD") @db.VarChar(10)
  last_updated DateTime @updatedAt

  user         user           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  transactions transactions[]

  @@map("wallets")
}

model transactions {
  id         Int             @id @default(autoincrement()) @db.Integer
  wallet_id  Int
  user_id    Int
  type       TransactionType
  amount     Decimal         @db.Decimal(10, 2)
  reference  String?         @db.VarChar(100)
  created_at DateTime        @default(now())

  wallet wallet @relation(fields: [wallet_id], references: [id], onDelete: Cascade)
  user   user   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model notification {
  id         Int              @id @default(autoincrement()) @db.Integer
  user_id    Int
  title      String?          @db.VarChar(100)
  message    String?          @db.Text
  type       NotificationType
  is_read    Boolean          @default(false)
  created_at DateTime         @default(now())

  user user @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model admin_logs {
  id          Int      @id @default(autoincrement()) @db.Integer
  admin_id    Int
  action      String   @db.VarChar(100)
  target_id   Int?
  target_type String?  @db.VarChar(20)
  created_at  DateTime @default(now())

  admin user @relation("admin_logs_user", fields: [admin_id], references: [id], onDelete: Cascade)

  @@map("admin_logs")
}

model dispute {
  id          Int           @id @default(autoincrement()) @db.Integer
  order_id    Int
  raised_by   Int
  reason      String?       @db.Text
  evidence    String[]
  status      DisputeStatus @default(OPEN)
  resolution  String?       @db.Text
  created_at  DateTime      @default(now())
  resolved_at DateTime?

  order  orders @relation(fields: [order_id], references: [id], onDelete: Cascade)
  raiser user   @relation(fields: [raised_by], references: [id], onDelete: Cascade)

  @@map("disputes")
}
